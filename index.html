<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles for printing */
        @media print {
            /* Hide the form controls and save/search section when printing */
            .no-print {
                display: none !important;
            }
            .printable-area {
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
                border: none;
            }
            body {
                background: white !important;
            }
            /* Style the invoice ID and content for printing */
            .print-data-box {
                border: 1px solid #ccc;
                padding: 1rem;
                border-radius: 0.5rem;
                margin-top: 1rem;
            }
            .print-label {
                font-weight: 600;
                color: #1056a0;
            }
        }
        /* Inter font for a professional look */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1056a0',
                        'secondary-gray': '#f4f4f5',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-secondary-gray min-h-screen p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto printable-area bg-white rounded-xl shadow-2xl p-6 md:p-10 border border-gray-100">

        <h1 class="text-3xl font-extrabold text-primary-blue mb-6 border-b-2 border-primary-blue pb-2">
            Invoice & Order Dashboard
        </h1>

        <!-- Submission Status Message Box -->
        <div id="message-box" class="hidden mb-6 p-4 rounded-lg text-sm transition-all duration-300" role="alert">
            <span id="message-text" class="font-medium"></span>
        </div>

        <!-- Customer and Order Information Form -->
        <form id="invoice-form" class="space-y-6">

            <!-- Hidden Input for Google Apps Script Target -->
            <!-- IMPORTANT: REPLACE THE 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE' with the actual URL from your setup. -->
            <!-- <input type="hidden" name="formUrl" id="formUrl" value="https://script.google.com/macros/s/AKfycbzRmugMoxT5WXCzNO1eNaYMCgYwFTfjaEQ8U9IN_-vSWn2E1i-xbFFB2294vagY4hGRPQ/exec"> -->

            <!-- Invoice ID Display -->
            <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                <span class="font-semibold text-gray-700">Invoice ID: </span>
                <span id="current-invoice-id" class="text-lg font-bold text-primary-blue"></span>
                <input type="hidden" name="invoiceId" id="invoiceIdInput">
            </div>

            <!-- Customer Details Section (Data Box for Printing) -->
            <div id="customer-data-box" class="p-4 bg-gray-50 rounded-lg border border-gray-200 print-data-box">
                <h2 class="text-xl font-semibold text-gray-700 mb-3 flex items-center no-print">
                    <i data-lucide="user-circle" class="w-5 h-5 mr-2 text-primary-blue"></i>
                    Customer Details
                </h2>
                <!-- Print view of customer details -->
                <div class="hidden print-only-view space-y-2">
                    <p><span class="print-label">Customer:</span> <span id="print-customer-name"></span></p>
                    <!-- <p><span class="print-label">Email:</span> <span id="print-customer-email"></span></p> -->
                    <p><span class="print-label">Address:</span> <span id="print-customer-address"></span></p>
                    <p><span class="print-label">Phone:</span> <span id="print-customer-number"></span></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 no-print">
                    <input type="text" name="customerName" id="customerName" placeholder="Customer Name" required
                        class="p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition-colors text-sm" oninput="updatePrintView()">
                    <input type="text" name="customerAddress" id="customerAddress" placeholder="Customer Address"
                        class="p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition-colors text-sm" oninput="updatePrintView()">
                    <input type="tel" name="customerNumber" id="customerNumber" placeholder="Phone Number"
                        class="p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition-colors text-sm" oninput="updatePrintView()">
                </div>
            </div>

            <!-- Order Items & Price Section (Data Box for Printing) -->
            <div id="order-data-box" class="p-4 bg-gray-50 rounded-lg border border-gray-200 print-data-box">
                <h2 class="text-xl font-semibold text-gray-700 mb-3 flex items-center no-print">
                    <i data-lucide="shopping-cart" class="w-5 h-5 mr-2 text-primary-blue"></i>
                    Order Items
                </h2>

                <!-- Print view of order details -->
                <div class="hidden print-only-view space-y-2">
                    <p class="print-label">Order Details:</p>
                    <pre id="print-order-items" class="bg-white p-2 rounded border border-gray-300 whitespace-pre-wrap text-sm"></pre>
                </div>
                
                <label for="orderItems" class="text-sm font-medium text-gray-700 mb-1 block no-print">List all ordered items/services:</label>
                <textarea name="orderItems" id="orderItems" rows="5" placeholder="Enter item 1, quantity, description, etc. (e.g., 5 hours of consultation, 1 x Premium Theme, etc.)" required
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition-colors text-sm mb-4 no-print" oninput="updatePrintView()"></textarea>

                <!-- Single Manual Price Input -->
                <div class="flex justify-end pt-4 border-t border-gray-300 no-print">
                    <div class="w-full md:w-80 space-y-2">
                        <label for="totalPriceInput" class="text-sm font-medium text-gray-700 block">Total Invoice Price ($):</label>
                        <input type="number" step="0.01" min="0" name="totalAmount" id="totalPriceInput" placeholder="0.00" required value="0.00" oninput="calculateTotal(); updatePrintView()"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition-colors text-lg text-right font-bold">
                    </div>
                </div>

                <!-- Totals Section for Display/Printing -->
                <div class="flex justify-end pt-4 border-t border-gray-300">
                    <div class="w-full md:w-80 space-y-2">
                        <div class="flex justify-between font-semibold text-lg text-gray-800">
                            <span>Total Amount:</span>
                            <span id="total-amount" class="text-2xl text-primary-blue font-bold">$0.00</span>
                            <!-- Hidden input is now the main price input -->
                        </div>
                    </div>
                </div>

            </div>

            <!-- Action Buttons -->
            <div class="no-print flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4 pt-6 border-t border-gray-200">
                
                <!-- Save Button (Submits to Google Sheet) -->
                <button type="submit" id="save-btn"
                    class="flex-1 px-6 py-3 text-white bg-green-600 rounded-lg shadow-md hover:bg-green-700 transition duration-150 font-semibold flex items-center justify-center">
                    <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                    Save Invoice
                </button>
                
                <!-- Print Button -->
                <button type="button" onclick="printInvoice()"
                    class="flex-1 px-6 py-3 text-primary-blue border border-primary-blue rounded-lg shadow-md hover:bg-primary-blue hover:text-white transition duration-150 font-semibold flex items-center justify-center">
                    <i data-lucide="printer" class="w-5 h-5 mr-2"></i>
                    Print Current Invoice
                </button>
            </div>
            
            <!-- Search/Lookup Section -->
            <div class="no-print pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
                    <i data-lucide="search" class="w-5 h-5 mr-2 text-primary-blue"></i>
                    Invoice Lookup
                </h3>
                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 items-stretch">
                    <input type="text" id="invoice-search-input" placeholder="Enter Invoice ID (e.g., INV-1700000000000)"
                        class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition-colors text-sm">
                    <button type="button" onclick="searchInvoice()" id="search-btn"
                        class="px-6 py-3 bg-primary-blue text-white rounded-lg font-semibold hover:bg-blue-700 transition duration-150 flex items-center justify-center">
                        <i data-lucide="binoculars" class="w-5 h-5 mr-2"></i>
                        Search
                    </button>
                </div>
            </div>
            
            <!-- Display Area for Search Results -->
            <div id="search-results" class="hidden mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h4 class="text-lg font-bold text-primary-blue mb-2">Search Result Details:</h4>
                <pre id="result-content" class="whitespace-pre-wrap text-sm text-gray-700"></pre>
            </div>

        </form>

    </div>

    <!-- JavaScript Logic -->
    <script src="invoice.js"></script>
</body>
</html>
